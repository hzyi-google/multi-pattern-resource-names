# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

module Grafeas
  module V1beta1
    module Vulnerability
      # Vulnerability provides metadata about a security vulnerability in a Note.
      # @!attribute [rw] cvss_score
      #   @return [Float]
      #     The CVSS score for this vulnerability.
      # @!attribute [rw] severity
      #   @return [Grafeas::V1beta1::Vulnerability::Severity]
      #     Note provider assigned impact of the vulnerability.
      # @!attribute [rw] details
      #   @return [Array<Grafeas::V1beta1::Vulnerability::Vulnerability::Detail>]
      #     All information about the package to specifically identify this
      #     vulnerability. One entry per (version range and cpe_uri) the package
      #     vulnerability has manifested in.
      # @!attribute [rw] cvss_v3
      #   @return [Grafeas::V1beta1::Vulnerability::CVSSv3]
      #     The full description of the CVSSv3.
      # @!attribute [rw] windows_details
      #   @return [Array<Grafeas::V1beta1::Vulnerability::Vulnerability::WindowsDetail>]
      #     Windows details get their own format because the information format and
      #     model don't match a normal detail. Specifically Windows updates are done as
      #     patches, thus Windows vulnerabilities really are a missing package, rather
      #     than a package being at an incorrect version.
      # @!attribute [rw] source_update_time
      #   @return [Google::Protobuf::Timestamp]
      #     The time this information was last changed at the source. This is an
      #     upstream timestamp from the underlying information source - e.g. Ubuntu
      #     security tracker.
      class Vulnerability
        # Identifies all appearances of this vulnerability in the package for a
        # specific distro/location. For example: glibc in
        # cpe:/o:debian:debian_linux:8 for versions 2.1 - 2.2
        # @!attribute [rw] cpe_uri
        #   @return [String]
        #     Required. The CPE URI in
        #     [cpe format](https://cpe.mitre.org/specification/) in which the
        #     vulnerability manifests. Examples include distro or storage location for
        #     vulnerable jar.
        # @!attribute [rw] package
        #   @return [String]
        #     Required. The name of the package where the vulnerability was found.
        # @!attribute [rw] min_affected_version
        #   @return [Grafeas::V1beta1::Package::Version]
        #     The min version of the package in which the vulnerability exists.
        # @!attribute [rw] max_affected_version
        #   @return [Grafeas::V1beta1::Package::Version]
        #     The max version of the package in which the vulnerability exists.
        # @!attribute [rw] severity_name
        #   @return [String]
        #     The severity (eg: distro assigned severity) for this vulnerability.
        # @!attribute [rw] description
        #   @return [String]
        #     A vendor-specific description of this note.
        # @!attribute [rw] fixed_location
        #   @return [Grafeas::V1beta1::Vulnerability::VulnerabilityLocation]
        #     The fix for this specific package version.
        # @!attribute [rw] package_type
        #   @return [String]
        #     The type of package; whether native or non native(ruby gems, node.js
        #     packages etc).
        # @!attribute [rw] is_obsolete
        #   @return [true, false]
        #     Whether this detail is obsolete. Occurrences are expected not to point to
        #     obsolete details.
        # @!attribute [rw] source_update_time
        #   @return [Google::Protobuf::Timestamp]
        #     The time this information was last changed at the source. This is an
        #     upstream timestamp from the underlying information source - e.g. Ubuntu
        #     security tracker.
        class Detail; end

        # @!attribute [rw] cpe_uri
        #   @return [String]
        #     Required. The CPE URI in
        #     [cpe format](https://cpe.mitre.org/specification/) in which the
        #     vulnerability manifests. Examples include distro or storage location for
        #     vulnerable jar.
        # @!attribute [rw] name
        #   @return [String]
        #     Required. The name of the vulnerability.
        # @!attribute [rw] description
        #   @return [String]
        #     The description of the vulnerability.
        # @!attribute [rw] fixing_kbs
        #   @return [Array<Grafeas::V1beta1::Vulnerability::Vulnerability::WindowsDetail::KnowledgeBase>]
        #     Required. The names of the KBs which have hotfixes to mitigate this
        #     vulnerability. Note that there may be multiple hotfixes (and thus
        #     multiple KBs) that mitigate a given vulnerability. Currently any listed
        #     kb's presence is considered a fix.
        class WindowsDetail
          # @!attribute [rw] name
          #   @return [String]
          #     The KB name (generally of the form KB[0-9]+ i.e. KB123456).
          # @!attribute [rw] url
          #   @return [String]
          #     A link to the KB in the Windows update catalog -
          #     https://www.catalog.update.microsoft.com/
          class KnowledgeBase; end
        end
      end

      # Details of a vulnerability Occurrence.
      # @!attribute [rw] type
      #   @return [String]
      #     The type of package; whether native or non native(ruby gems, node.js
      #     packages etc)
      # @!attribute [rw] severity
      #   @return [Grafeas::V1beta1::Vulnerability::Severity]
      #     Output only. The note provider assigned Severity of the vulnerability.
      # @!attribute [rw] cvss_score
      #   @return [Float]
      #     Output only. The CVSS score of this vulnerability. CVSS score is on a
      #     scale of 0-10 where 0 indicates low severity and 10 indicates high
      #     severity.
      # @!attribute [rw] package_issue
      #   @return [Array<Grafeas::V1beta1::Vulnerability::PackageIssue>]
      #     Required. The set of affected locations and their fixes (if available)
      #     within the associated resource.
      # @!attribute [rw] short_description
      #   @return [String]
      #     Output only. A one sentence description of this vulnerability.
      # @!attribute [rw] long_description
      #   @return [String]
      #     Output only. A detailed description of this vulnerability.
      # @!attribute [rw] related_urls
      #   @return [Array<Grafeas::V1beta1::RelatedUrl>]
      #     Output only. URLs related to this vulnerability.
      # @!attribute [rw] effective_severity
      #   @return [Grafeas::V1beta1::Vulnerability::Severity]
      #     The distro assigned severity for this vulnerability when it is
      #     available, and note provider assigned severity when distro has not yet
      #     assigned a severity for this vulnerability.
      class Details; end

      # This message wraps a location affected by a vulnerability and its
      # associated fix (if one is available).
      # @!attribute [rw] affected_location
      #   @return [Grafeas::V1beta1::Vulnerability::VulnerabilityLocation]
      #     Required. The location of the vulnerability.
      # @!attribute [rw] fixed_location
      #   @return [Grafeas::V1beta1::Vulnerability::VulnerabilityLocation]
      #     The location of the available fix for vulnerability.
      # @!attribute [rw] severity_name
      #   @return [String]
      #     Deprecated, use Details.effective_severity instead
      #     The severity (e.g., distro assigned severity) for this vulnerability.
      class PackageIssue; end

      # The location of the vulnerability.
      # @!attribute [rw] cpe_uri
      #   @return [String]
      #     Required. The CPE URI in [cpe format](https://cpe.mitre.org/specification/)
      #     format. Examples include distro or storage location for vulnerable jar.
      # @!attribute [rw] package
      #   @return [String]
      #     Required. The package being described.
      # @!attribute [rw] version
      #   @return [Grafeas::V1beta1::Package::Version]
      #     Required. The version of the package being described.
      class VulnerabilityLocation; end

      # Note provider-assigned severity/impact ranking.
      module Severity
        # Unknown.
        SEVERITY_UNSPECIFIED = 0

        # Minimal severity.
        MINIMAL = 1

        # Low severity.
        LOW = 2

        # Medium severity.
        MEDIUM = 3

        # High severity.
        HIGH = 4

        # Critical severity.
        CRITICAL = 5
      end
    end
  end
end